!function(){"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var n=i.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&!e;)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}();var e=async(t,e)=>{const i=fetch(t,e),n=await i;if(n.ok)return 204===n.status?n.status:await n.json();console.error("Ошибка")};class i{constructor(t){this.baseURL=t}list(t){const i=new URLSearchParams({method:"allTickets"}),n=`${this.baseURL}?${i.toString()}`,s={method:"GET",headers:{"Content-Type":"application/json"}};(async()=>{(await e(n,s)).forEach((e=>{t(e)}))})()}get(t,i){if(!t)return;const n=new URLSearchParams({method:"ticketById",id:t}),s=`${this.baseURL}?${n.toString()}`,c={method:"GET",headers:{"Content-Type":"application/json"}};(async()=>{const t=await e(s,c);i(t)})()}create(t,i){if(!t.name)return;const n=new URLSearchParams({method:"createTicket"}),s=`${this.baseURL}?${n.toString()}`,c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};(async()=>{const t=await e(s,c);i(t)})()}update(t,i,n){if(!t)return;const s=new URLSearchParams({method:"updateById",id:t}),c=`${this.baseURL}?${s.toString()}`,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)};(async()=>{const t=await e(c,r);n(t)})()}delete(t,i){if(!t)return;const n=new URLSearchParams({method:"deleteById",id:t}),s=`${this.baseURL}?${n.toString()}`,c={method:"DELETE",headers:{"Content-Type":"application/json"}};(async()=>{204===await e(s,c)&&i(t)})()}}function n(t,e,...i){const n=document.createElement(e);return i.forEach((t=>{n.classList.add(t)})),t.appendChild(n),n}function s(t){document.querySelector(`.modal-${t}`).classList.add("modal-flex")}function c(t){document.querySelector(`.modal-${t}`).classList.remove("modal-flex")}function r(t){const e=document.querySelector(".modal-edit");e.querySelector(".input-name").value=t.name,e.querySelector(".input-description").value=t.description}var o=t.p+"832b45baedc0f752e451.png",a=t.p+"5b1ab42f0b214991664c.png",d=t.p+"6367da8821367a20344a.png";class l{constructor(t){this.container=t}ticketDraw(t){let e;const i=n(this.container,"div","ticket");i.id=t.id;const s=n(i,"div","ticket-short"),c=n(s,"div","circle","done-btn"),r=n(c,"img","img-btn");t.status||r.classList.add("invisible"),r.src=a,n(s,"div","ticket-name").textContent=t.name;const l=n(s,"div","ticket-date");e=new Date(t.created),l.textContent=e.toLocaleString("ru",{year:"2-digit",month:"2-digit",day:"2-digit"})+" "+e.toLocaleString("ru",{hour:"2-digit",minute:"2-digit"});const h=n(s,"div","circle","edit-btn");n(h,"img","img-btn").src=o;const m=n(s,"div","circle","delete-btn");n(m,"img","img-btn").src=d}ticketDelete(t){document.getElementById(t).remove()}ticketUpdate(t){for(;this.container.firstChild;)this.container.firstChild.remove();t.forEach((t=>{this.ticketDraw(t)}))}ticketDescription(t){n(document.getElementById(t.id),"div","ticket-description").textContent=t.description}}class h{constructor(t){this.container=t}render(t){const e=n(this.container,"div","modal",`modal-${t}`),i=n(e,"form","modal-form"),s=n(i,"div","form-header");switch(t){case"add":s.textContent="Добавить тикет";break;case"edit":s.textContent="Изменить тикет";break;case"delete":s.textContent="Удалить тикет"}if("add"===t||"edit"===t){const t=n(i,"label","form-text");t.textContent="Краткое описание",n(t,"input","input","input-name").name="name";const e=n(i,"label","form-text");e.textContent="Подробное описание",n(e,"textarea","input","input-description").name="description"}else"delete"===t&&(n(i,"div","form-text").textContent="Вы уверены, что хотите удалить тикет?  Это действие необратимо.");const r=n(i,"div","buttons-section"),o=n(r,"button","cancel-button","btn");o.type="reset",o.textContent="Отмена",o.addEventListener("click",(e=>{e.preventDefault(),c(t)}));const a=n(r,"button","ok-button","btn");return a.type="submit",a.textContent="OK",e}}const m=document.getElementById("root");new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t,this.ticketService=new i("http://localhost:7070"),this.addTicket=this.addTicket.bind(this),this.editTicket=this.editTicket.bind(this),this.deleteTicket=this.deleteTicket.bind(this),this.showDescription=this.showDescription.bind(this),this.targetTicket=null}init(){const t=this.drawUI();this.ticketView=new l(t);const e=this.ticketView.ticketDraw.bind(this.ticketView);this.ticketService.list(e),t.addEventListener("click",(t=>{t.preventDefault();const e=t.target.closest(".circle");if(this.targetTicket=t.target.closest(".ticket"),e){if(e.classList.contains("edit-btn"))return s("edit"),void this.ticketService.get(this.targetTicket.id,r);if(e.classList.contains("delete-btn"))s("delete");else if(e.classList.contains("done-btn")){const t=e.querySelector(".img-btn");let i;t.classList.contains("invisible")?(t.classList.remove("invisible"),i={status:!0}):(t.classList.add("invisible"),i={status:!1});const n=this.ticketView.ticketUpdate.bind(this.ticketView);this.ticketService.update(this.targetTicket.id,i,n)}}else this.showDescription(this.targetTicket)}))}drawUI(){const t=n(this.container,"div","desk"),e=n(t,"div","desk-header");n(e,"div","desk-header-menu-btn");const i=n(t,"div","desk-content"),c=n(i,"button","btn","add-btn");return c.textContent="Добавить тикет",c.addEventListener("click",(()=>{s("add")})),new h(i).render("add").querySelector(".modal-form").addEventListener("submit",this.addTicket),new h(i).render("edit").querySelector(".modal-form").addEventListener("submit",this.editTicket),new h(i).render("delete").querySelector(".modal-form").addEventListener("submit",this.deleteTicket),n(i,"div","ticket-list")}showDescription(t){let e;if(t.classList.contains("withDescription"))e=t.querySelector(".ticket-description"),t.classList.remove("withDescription"),t.removeChild(e);else{const e=this.ticketView.ticketDescription.bind(this.ticketView);this.ticketService.get(t.id,e),t.classList.add("withDescription")}}addTicket(t){t.preventDefault();let e={};Array.from(t.target.elements).filter((t=>!!t.name)).forEach((t=>{const{name:i,value:n}=t;e[i]=n}));const i=this.ticketView.ticketDraw.bind(this.ticketView);this.ticketService.create(e,i),c("add")}editTicket(t){t.preventDefault();const e=this.targetTicket.id;let i={};Array.from(t.target.elements).filter((t=>!!t.name)).forEach((t=>{const{name:e,value:n}=t;i[e]=n}));const n=this.ticketView.ticketUpdate.bind(this.ticketView);this.ticketService.update(e,i,n),c("edit")}deleteTicket(t){t.preventDefault();const e=this.targetTicket.id,i=this.ticketView.ticketDelete.bind(this.ticketView);this.ticketService.delete(e,i),c("delete")}}(m).init()}();
//# sourceMappingURL=main.js.map